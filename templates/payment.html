{% extends "base.html" %}

{% block title %}Complete Payment - ClearQ{% endblock %}

{% block content %}
<div style="padding: 50px; text-align: center;">
    <h1>Payment Page - Simplified</h1>
    <p>Booking ID: {{ booking.id }}</p>
    <p>Amount: ₹{{ booking.amount_paid }}</p>
    
    <button id="rzp-button" style="padding: 20px; background: blue; color: white; font-size: 20px;">
        PAY NOW
    </button>
    
    <div id="debug" style="margin-top: 20px; padding: 10px; background: #f0f0f0;"></div>
</div>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log("=== SIMPLE PAYMENT TEST ===");
    
    const debugDiv = document.getElementById('debug');
    
    // Check Razorpay
    if (typeof Razorpay === 'undefined') {
        debugDiv.innerHTML = "❌ Razorpay script not loaded!";
        return;
    }
    
    debugDiv.innerHTML = "✅ Razorpay loaded<br>";
    
    // Check key
    const key = "{{ razorpay_key_id }}";
    if (!key || key === 'None') {
        debugDiv.innerHTML += "❌ Razorpay key missing!";
        return;
    }
    
    debugDiv.innerHTML += "✅ Key: " + key.substring(0, 10) + "...<br>";
    
    // Setup payment
    const options = {
        "key": key,
        "amount": {{ booking.amount_paid }} * 100,
        "currency": "INR",
        "name": "ClearQ",
        "description": "Booking #{{ booking.id }}",
        "order_id": "{{ booking.razorpay_order_id }}",
        "handler": function(response) {
            debugDiv.innerHTML += "✅ Payment success! ID: " + response.razorpay_payment_id;
            alert("Payment successful!");
        },
        "theme": {"color": "#4F46E5"}
    };
    
    console.log("Options:", options);
    
    // Button click
    document.getElementById('rzp-button').onclick = function(e) {
        e.preventDefault();
        debugDiv.innerHTML += "✅ Button clicked!<br>";
        
        try {
            var rzp = new Razorpay(options);
            rzp.open();
            debugDiv.innerHTML += "✅ Razorpay opened<br>";
        } catch (error) {
            debugDiv.innerHTML += "❌ Error: " + error.message;
            console.error(error);
        }
    };
});
</script>
{% endblock %}
