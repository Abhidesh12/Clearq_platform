<!-- templates/payment.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Payment - {{ service.name if service else 'Booking' }}</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Razorpay -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    
    <style>
        /* Enhanced Theme CSS Variables */
        :root {
            --primary: #1f1f1f;
            --primary-hover: #000000;
            --accent: #ff6b4a;
            --accent-light: #fff0ec;
            --secondary: #2D3748;
            --brand-red: #FF3F1F;
            --brand-red-light: #fff2f0;
            --background-light: linear-gradient(135deg, #fff5ec 0%, #fff9f5 100%);
            --background-dark: #151022;
            --card-light: #ffffff;
            --card-dark: #1e1a2e;
            --text-light: #1f1f1f;
            --text-dark: #ffffff;
            --text-secondary-light: #6b7280;
            --text-secondary-dark: #a09db3;
            --border-light: #E5E4E0;
            --border-dark: #2d2a3b;
            --card-green: #10b981;
            --card-green-light: #f0fdf4;
            --card-blue: #3b82f6;
            --card-blue-light: #eff6ff;
            --card-purple: #8b5cf6;
            --card-purple-light: #f5f3ff;
            --card-yellow: #f59e0b;
            --card-yellow-light: #fffbeb;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --shadow-xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        body {
            background: var(--background-light);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
        }

        /* Enhanced Loader */
        .loader {
            border: 3px solid var(--border-light);
            border-top: 3px solid var(--accent);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s cubic-bezier(0.68, -0.55, 0.27, 1.55) infinite;
            display: inline-block;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Glow Effects */
        .glow-effect {
            position: relative;
        }
        
        .glow-effect::after {
            content: '';
            position: absolute;
            inset: -2px;
            background: linear-gradient(45deg, var(--accent), var(--card-blue), var(--card-green));
            border-radius: inherit;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .glow-effect:hover::after {
            opacity: 0.4;
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from {
                filter: blur(10px);
                opacity: 0.3;
            }
            to {
                filter: blur(20px);
                opacity: 0.6;
            }
        }
        
        /* Enhanced Animations */
        .payment-success {
            animation: fadeInUp 0.6s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        /* Floating Animation */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .float-animation {
            animation: float 3s ease-in-out infinite;
        }
        
        /* Enhanced Status Indicator */
        .status-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin: 30px 0;
            position: relative;
        }
        
        .status-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
        }
        
        .status-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            border: 3px solid var(--border-light);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            position: relative;
            z-index: 2;
        }
        
        .status-dot.active {
            border-color: var(--accent);
            background: var(--accent);
            transform: scale(1.1);
            box-shadow: 0 0 0 4px rgba(255, 107, 74, 0.2);
        }
        
        .status-dot.active::before {
            content: '';
            position: absolute;
            inset: -4px;
            border-radius: 50%;
            border: 2px solid var(--accent);
            animation: pulse 2s infinite;
        }
        
        .status-dot.completed {
            border-color: var(--card-green);
            background: var(--card-green);
        }
        
        .status-dot.completed::after {
            content: 'âœ“';
            color: white;
            font-size: 10px;
            font-weight: bold;
        }
        
        .status-label {
            margin-top: 8px;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary-light);
            transition: all 0.3s ease;
            text-align: center;
            min-width: 80px;
        }
        
        .status-label.active {
            color: var(--accent);
            font-weight: 600;
        }
        
        .status-label.completed {
            color: var(--card-green);
        }
        
        .status-line {
            flex: 1;
            height: 3px;
            background: linear-gradient(to right, var(--border-light), var(--border-light));
            margin: 0 10px;
            position: relative;
            overflow: hidden;
        }
        
        .status-line.active::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 100%;
            background: linear-gradient(90deg, var(--card-green), var(--accent));
            animation: lineProgress 1s ease-out;
            transform-origin: left;
        }
        
        @keyframes lineProgress {
            from { transform: scaleX(0); }
            to { transform: scaleX(1); }
        }
        
        /* Enhanced Progress Bar */
        .progress-container {
            width: 100%;
            height: 8px;
            background: var(--border-light);
            border-radius: 4px;
            overflow: hidden;
            margin: 30px 0;
            position: relative;
        }
        
        .progress-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                transparent 25%, 
                rgba(255, 255, 255, 0.3) 50%, 
                transparent 75%);
            animation: shimmer 2s infinite;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, 
                var(--card-green), 
                var(--card-blue), 
                var(--accent));
            width: 0%;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 4px;
            position: relative;
            z-index: 1;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* Enhanced Cards */
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: var(--shadow-lg);
        }
        
        .gradient-border {
            border: double 2px transparent;
            background-image: linear-gradient(white, white), 
                              linear-gradient(45deg, var(--accent), var(--card-blue));
            background-origin: border-box;
            background-clip: content-box, border-box;
        }
        
        /* Enhanced Payment Options */
        .payment-option {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            border-radius: 16px;
            overflow: hidden;
            position: relative;
        }
        
        .payment-option::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, 
                rgba(255, 107, 74, 0.1), 
                rgba(59, 130, 246, 0.1));
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .payment-option:hover::before {
            opacity: 1;
        }
        
        .payment-option.active {
            border-color: var(--accent) !important;
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }
        
        .payment-option.active::before {
            opacity: 1;
        }
        
        /* Enhanced Notification */
        .notification-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 20px;
            border-radius: 12px;
            font-weight: 500;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 12px;
            max-width: 400px;
            transform: translateX(120%);
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: var(--shadow-xl);
        }
        
        .notification-toast.show {
            transform: translateX(0);
        }
        
        /* Enhanced Inputs */
        .input-glow:focus {
            box-shadow: 0 0 0 4px rgba(255, 107, 74, 0.1),
                        0 0 0 1px var(--accent);
            border-color: transparent;
        }
        
        /* Enhanced Buttons */
        .btn-primary {
            background: linear-gradient(135deg, var(--accent), var(--brand-red));
            color: white;
            font-weight: 600;
            padding: 16px 32px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn-primary:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-primary:active {
            transform: translateY(0);
        }
        
        /* Enhanced Badges */
        .status-badge {
            padding: 6px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 12px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            backdrop-filter: blur(10px);
        }
        
        /* Enhanced Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--border-light);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--brand-red);
        }
        
        /* Hover Effects */
        .hover-lift {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .hover-lift:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }
        
        /* Page Load Animation */
        @keyframes pageLoad {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .page-content {
            animation: pageLoad 0.6s ease-out;
        }
        
        /* Success Check Animation */
        .success-check {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            position: relative;
        }
        
        .success-check::before {
            content: '';
            position: absolute;
            inset: -4px;
            border-radius: 50%;
            border: 3px solid var(--card-green);
            animation: checkRing 0.6s ease-out;
        }
        
        .success-check i {
            font-size: 36px;
            color: var(--card-green);
            animation: checkScale 0.6s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }
        
        @keyframes checkRing {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        @keyframes checkScale {
            0% { transform: scale(0); }
            70% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        /* Ripple Effect */
        .ripple {
            position: relative;
            overflow: hidden;
        }
        
        .ripple::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }
        
        .ripple:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }
        
        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            100% {
                transform: scale(20, 20);
                opacity: 0;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-white via-orange-50 to-pink-50 min-h-screen">
    <!-- Enhanced Navigation -->
    <nav class="sticky top-0 z-40 backdrop-blur-lg bg-white/80 shadow-sm border-b border-gray-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <a href="/dashboard" class="text-xl font-bold text-gray-900 hover:text-accent transition-colors flex items-center gap-2">
                        <div class="w-8 h-8 bg-gradient-to-br from-accent to-brand-red rounded-lg flex items-center justify-center">
                            <i class="fas fa-graduation-cap text-white text-sm"></i>
                        </div>
                        <span>ClearQ</span>
                    </a>
                </div>
                <div class="flex items-center gap-4">
                    <div class="flex items-center gap-2 px-3 py-1.5 bg-gray-50 rounded-full">
                        <div class="w-6 h-6 bg-gradient-to-br from-gray-300 to-gray-400 rounded-full flex items-center justify-center">
                            <i class="fas fa-user text-white text-xs"></i>
                        </div>
                        <span class="text-sm font-medium text-gray-700">{{ current_user.full_name.split()[0] }}</span>
                    </div>
                    <a href="/logout" class="p-2 text-gray-400 hover:text-brand-red transition-colors rounded-full hover:bg-red-50">
                        <i class="fas fa-sign-out-alt"></i>
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-6xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
        <!-- Back Button with Enhanced Style -->
        <a href="/dashboard" class="inline-flex items-center gap-2 text-gray-600 hover:text-accent transition-colors mb-6 group">
            <div class="w-8 h-8 rounded-full bg-gray-100 group-hover:bg-accent/10 flex items-center justify-center transition-colors">
                <i class="fas fa-arrow-left text-sm group-hover:text-accent"></i>
            </div>
            <span class="font-medium">Back to Dashboard</span>
        </a>

        <!-- Page Header -->
        <div class="text-center mb-12">
            <div class="inline-block p-3 bg-gradient-to-br from-accent/10 to-brand-red/10 rounded-2xl mb-4 float-animation">
                <i class="fas fa-credit-card text-3xl text-accent"></i>
            </div>
            <h1 class="text-4xl font-bold text-gray-900 mb-3 bg-gradient-to-r from-gray-900 via-accent to-brand-red bg-clip-text text-transparent">
                Complete Your Payment
            </h1>
            <p class="text-gray-600 max-w-2xl mx-auto text-lg">
                {% if mentor and mentor.user %}
                    Secure payment for your booking with 
                    <span class="font-semibold text-accent">{{ mentor.user.full_name }}</span>
                {% elif mentor %}
                    Secure payment for your booking with 
                    <span class="font-semibold text-accent">{{ mentor.full_name if mentor.full_name else 'Mentor' }}</span>
                {% else %}
                    Complete your secure payment to confirm the booking
                {% endif %}
            </p>
        </div>

        <!-- Enhanced Status Indicator -->
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-8 border border-gray-100">
            <div class="status-indicator">
                <div class="status-step">
                    <div class="status-dot completed"></div>
                    <div class="status-label completed">Select Service</div>
                </div>
                <div class="status-line active"></div>
                <div class="status-step">
                    <div class="status-dot completed"></div>
                    <div class="status-label completed">Choose Time</div>
                </div>
                <div class="status-line active"></div>
                <div class="status-step">
                    <div class="status-dot active"></div>
                    <div class="status-label active">Make Payment</div>
                </div>
            </div>
        </div>

        <!-- Booking Summary Card -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
            <!-- Service Details Card -->
            <div class="lg:col-span-2">
                <div class="glass-card rounded-2xl shadow-lg overflow-hidden border border-gray-100 hover-lift">
                    <div class="bg-gradient-to-r from-gray-900 to-gray-800 p-6">
                        <h2 class="text-xl font-semibold text-white flex items-center gap-2">
                            <i class="fas fa-receipt"></i>
                            Booking Summary
                        </h2>
                        <p class="text-gray-300 text-sm mt-1">Review your booking details before payment</p>
                    </div>
                    
                    <div class="p-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Service Details -->
                            <div>
                                <div class="flex items-start gap-3 mb-4">
                                    <div class="w-10 h-10 rounded-lg bg-blue-50 flex items-center justify-center flex-shrink-0">
                                        <i class="fas fa-book text-blue-600"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600 mb-1">Service</p>
                                        <p class="font-semibold text-gray-900">{{ service.name if service else 'N/A' }}</p>
                                    </div>
                                </div>
                                
                                <div class="flex items-start gap-3 mb-4">
                                    <div class="w-10 h-10 rounded-lg bg-green-50 flex items-center justify-center flex-shrink-0">
                                        <i class="fas fa-money-bill text-green-600"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600 mb-1">Price</p>
                                        <p class="font-semibold text-gray-900">
                                            â‚¹{{ booking.amount_paid if booking.amount_paid else service.price }}
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- Mentor & Timing -->
                            <div>
                                {% if mentor and mentor.user %}
                                <div class="flex items-start gap-3 mb-4">
                                    <div class="w-10 h-10 rounded-lg bg-accent/10 flex items-center justify-center flex-shrink-0">
                                        <i class="fas fa-user-tie text-accent"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600 mb-1">Mentor</p>
                                        <p class="font-semibold text-gray-900">{{ mentor.user.full_name }}</p>
                                    </div>
                                </div>
                                {% endif %}
                                
                                <div class="flex items-start gap-3 mb-4">
                                    <div class="w-10 h-10 rounded-lg bg-purple-50 flex items-center justify-center flex-shrink-0">
                                        <i class="fas fa-calendar-alt text-purple-600"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600 mb-1">Booking ID</p>
                                        <p class="font-semibold text-gray-900">#{{ booking.id }}</p>
                                    </div>
                                </div>
                                
                                {% if booking.selected_time %}
                                <div class="flex items-start gap-3">
                                    <div class="w-10 h-10 rounded-lg bg-yellow-50 flex items-center justify-center flex-shrink-0">
                                        <i class="fas fa-clock text-yellow-600"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600 mb-1">Time</p>
                                        <p class="font-semibold text-gray-900">{{ booking.selected_time }}</p>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Payment Summary Card -->
            <div class="lg:col-span-1">
                <div class="glass-card rounded-2xl shadow-lg overflow-hidden border border-gray-100 hover-lift">
                    <div class="bg-gradient-to-r from-accent to-brand-red p-6">
                        <h2 class="text-xl font-semibold text-white flex items-center gap-2">
                            <i class="fas fa-money-check-alt"></i>
                            Payment Summary
                        </h2>
                    </div>
                    
                    <div class="p-6">
                        <div class="space-y-4">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">Amount</span>
                                <span class="font-semibold text-gray-900">
                                    â‚¹{{ booking.amount_paid if booking.amount_paid else (service.price if service else 0) }}
                                </span>
                            </div>
                            
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">Processing Fees</span>
                                <span class="font-semibold text-gray-900">â‚¹0.00</span>
                            </div>
                            
                            <div class="border-t border-gray-200 pt-4 mt-4">
                                <div class="flex justify-between items-center">
                                    <span class="text-lg font-semibold text-gray-900">Total Amount</span>
                                    <span class="text-2xl font-bold text-accent">
                                        â‚¹{{ booking.amount_paid if booking.amount_paid else (service.price if service else 0) }}
                                    </span>
                                </div>
                            </div>
                            
                            <div class="pt-4">
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-600">Status</span>
                                    <span class="status-badge 
                                        {% if booking.payment_status == 'pending' %}bg-yellow-100 text-yellow-800
                                        {% elif booking.payment_status == 'paid' %}bg-green-100 text-green-800
                                        {% elif booking.payment_status == 'failed' %}bg-red-100 text-red-800
                                        {% else %}bg-gray-100 text-gray-800{% endif %}">
                                        <i class="fas fa-circle text-xs"></i>
                                        {{ booking.payment_status if booking.payment_status else 'pending' }}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Payment Section -->
        <div class="glass-card rounded-2xl shadow-lg overflow-hidden border border-gray-100 mb-8">
            <div class="p-8">
                <!-- Payment Header -->
                <div class="flex flex-col md:flex-row md:items-center justify-between mb-8 gap-4">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900 mb-2">
                            <i class="fas fa-lock text-accent mr-2"></i>
                            Secure Payment
                        </h2>
                        <p class="text-gray-600">Choose your preferred payment method</p>
                    </div>
                    <div class="flex items-center gap-2 px-4 py-2 bg-green-50 rounded-full">
                        <i class="fas fa-shield-alt text-green-600"></i>
                        <span class="text-sm font-medium text-green-700">256-bit SSL Secured</span>
                    </div>
                </div>

                <!-- Payment Provider -->
                <div class="flex flex-col items-center justify-center mb-8">
                    <div class="bg-gradient-to-r from-blue-50 to-purple-50 px-6 py-4 rounded-xl mb-4">
                        <img src="https://razorpay.com/assets/razorpay-logo.svg" alt="Razorpay" class="h-10">
                    </div>
                    <p class="text-gray-600 text-center max-w-lg">
                        You'll be redirected to Razorpay's secure payment gateway to complete your transaction.
                        All transactions are encrypted and secure.
                    </p>
                </div>

                <!-- Payment Methods -->
                <div class="mb-8">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
                        <i class="fas fa-credit-card text-gray-400"></i>
                        Choose Payment Method
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <!-- Credit/Debit Card -->
                        <div class="payment-option p-5 border-2 border-gray-200 rounded-xl cursor-pointer hover-lift" 
                             onclick="selectPaymentMethod('card')" id="cardOption">
                            <div class="flex flex-col items-center text-center">
                                <div class="w-16 h-16 rounded-full bg-gradient-to-br from-blue-50 to-blue-100 flex items-center justify-center mb-3">
                                    <i class="fas fa-credit-card text-blue-600 text-2xl"></i>
                                </div>
                                <p class="font-semibold text-gray-900">Credit/Debit Card</p>
                                <p class="text-sm text-gray-600 mt-1">Visa, MasterCard, RuPay</p>
                                <div class="flex gap-1 mt-2">
                                    <div class="w-8 h-5 bg-blue-500 rounded"></div>
                                    <div class="w-8 h-5 bg-red-500 rounded"></div>
                                    <div class="w-8 h-5 bg-yellow-500 rounded"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- UPI -->
                        <div class="payment-option p-5 border-2 border-gray-200 rounded-xl cursor-pointer hover-lift"
                             onclick="selectPaymentMethod('upi')" id="upiOption">
                            <div class="flex flex-col items-center text-center">
                                <div class="w-16 h-16 rounded-full bg-gradient-to-br from-green-50 to-green-100 flex items-center justify-center mb-3">
                                    <i class="fas fa-mobile-alt text-green-600 text-2xl"></i>
                                </div>
                                <p class="font-semibold text-gray-900">UPI</p>
                                <p class="text-sm text-gray-600 mt-1">Google Pay, PhonePe, Paytm</p>
                                <div class="flex gap-2 mt-2">
                                    <span class="text-xs px-2 py-1 bg-green-100 text-green-700 rounded">GPay</span>
                                    <span class="text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded">PhonePe</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Net Banking -->
                        <div class="payment-option p-5 border-2 border-gray-200 rounded-xl cursor-pointer hover-lift"
                             onclick="selectPaymentMethod('netbanking')" id="netbankingOption">
                            <div class="flex flex-col items-center text-center">
                                <div class="w-16 h-16 rounded-full bg-gradient-to-br from-purple-50 to-purple-100 flex items-center justify-center mb-3">
                                    <i class="fas fa-university text-purple-600 text-2xl"></i>
                                </div>
                                <p class="font-semibold text-gray-900">Net Banking</p>
                                <p class="text-sm text-gray-600 mt-1">All major banks</p>
                                <div class="flex gap-1 mt-2">
                                    <div class="text-xs px-2 py-1 bg-gray-100 text-gray-700 rounded">HDFC</div>
                                    <div class="text-xs px-2 py-1 bg-gray-100 text-gray-700 rounded">ICICI</div>
                                    <div class="text-xs px-2 py-1 bg-gray-100 text-gray-700 rounded">SBI</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Selected Method Indicator -->
                    <div id="selectedMethod" class="mt-6 p-4 bg-gradient-to-r from-accent/5 to-accent/10 border border-accent/20 rounded-xl hidden">
                        <div class="flex items-center">
                            <div class="w-8 h-8 rounded-full bg-accent flex items-center justify-center mr-3">
                                <i class="fas fa-check text-white text-sm"></i>
                            </div>
                            <div>
                                <p class="font-medium text-gray-900">Selected Method</p>
                                <p class="text-sm text-gray-600" id="selectedMethodText"></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Amount Display -->
                <div class="text-center mb-8">
                    {% set payment_amount = booking.amount_paid if booking.amount_paid else (service.price if service else 0) %}
                    <div class="inline-block bg-gradient-to-r from-gray-50 to-gray-100 px-8 py-6 rounded-2xl shadow-inner">
                        <p class="text-sm text-gray-600 mb-2">Total Amount to Pay</p>
                        <p class="text-4xl font-bold text-gray-900 mb-1">â‚¹{{ payment_amount }}</p>
                        <p class="text-xs text-gray-500">+ Razorpay processing fees may apply</p>
                    </div>
                </div>

                <!-- Payment Button -->
                <div class="text-center">
                    {% set payment_amount = booking.amount_paid if booking.amount_paid else (service.price if service else 0) %}
                    
                    {% if booking.payment_status == 'paid' %}
                    <div class="bg-gradient-to-r from-green-50 to-green-100 border border-green-200 rounded-2xl p-8 mb-6 payment-success">
                        <div class="success-check mb-4">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <p class="text-green-800 font-semibold text-lg mb-2">Payment Already Completed</p>
                        <p class="text-green-600 mb-6">Your booking is confirmed and paid.</p>
                        <div class="flex flex-col sm:flex-row gap-3 justify-center">
                            {% if service and service.is_digital %}
                            <a href="/digital-product/{{ service.id }}" 
                               class="btn-primary bg-gradient-to-r from-green-600 to-green-700">
                                <i class="fas fa-download mr-2"></i>Access Digital Product
                            </a>
                            {% elif booking.meeting_link %}
                            <a href="/meeting/{{ booking.id }}" 
                               class="btn-primary bg-gradient-to-r from-blue-600 to-blue-700">
                                <i class="fas fa-video mr-2"></i>Go to Meeting
                            </a>
                            {% endif %}
                            <a href="/dashboard" 
                               class="px-6 py-3 bg-gray-900 hover:bg-black text-white font-semibold rounded-lg transition-colors">
                                <i class="fas fa-home mr-2"></i>Go to Dashboard
                            </a>
                        </div>
                    </div>
                    {% else %}
                    <button id="payButton" 
                            class="btn-primary px-12 py-4 text-lg font-semibold glow-effect ripple mb-6"
                            onclick="initializePayment()">
                        <i class="fas fa-lock mr-3"></i>
                        Pay â‚¹{{ payment_amount }} Now
                    </button>
                    
                    <!-- Progress Bar -->
                    <div class="progress-container mb-6">
                        <div class="progress-bar" id="paymentProgress"></div>
                    </div>
                    
                    <!-- Manual UPI Option -->
                    <div class="mt-8 p-5 bg-gradient-to-r from-gray-50 to-gray-100 border border-gray-200 rounded-xl">
                        <h4 class="font-semibold text-gray-900 mb-3 flex items-center gap-2">
                            <i class="fas fa-qrcode text-accent"></i>
                            Manual UPI Payment
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="flex flex-col justify-center">
                                <p class="text-sm text-gray-600 mb-2">Use this UPI ID:</p>
                                <div class="flex items-center gap-3">
                                    <code class="font-mono text-lg text-accent bg-white px-4 py-2 rounded-lg">clearq@razorpay</code>
                                    <button onclick="copyUPI()" class="px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                                        <i class="fas fa-copy mr-2"></i>Copy
                                    </button>
                                </div>
                                <p class="text-xs text-gray-500 mt-2">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    Include Booking ID: #{{ booking.id }} in the payment note
                                </p>
                            </div>
                            <div class="flex flex-col items-center">
                                <div class="w-32 h-32 bg-white rounded-lg flex items-center justify-center border border-gray-200">
                                    <i class="fas fa-qrcode text-4xl text-gray-300"></i>
                                </div>
                                <p class="text-xs text-gray-500 mt-2">Scan to pay via any UPI app</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Terms -->
                    <p class="text-gray-600 text-sm mt-8 text-center">
                        <i class="fas fa-lock mr-1"></i>
                        By proceeding, you agree to our 
                        <a href="/terms" class="text-accent hover:underline font-medium">Terms of Service</a> and 
                        <a href="/privacy" class="text-accent hover:underline font-medium">Privacy Policy</a>
                    </p>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Important Notes -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <!-- Security Info -->
            <div class="bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-200 rounded-xl p-5">
                <div class="flex items-center gap-3 mb-3">
                    <div class="w-10 h-10 rounded-full bg-blue-200 flex items-center justify-center">
                        <i class="fas fa-shield-alt text-blue-600"></i>
                    </div>
                    <h4 class="font-semibold text-gray-900">Bank-Level Security</h4>
                </div>
                <p class="text-sm text-gray-700">
                    All payments are encrypted with 256-bit SSL security. Your card details are never stored on our servers.
                </p>
            </div>
            
            <!-- Support Info -->
            <div class="bg-gradient-to-br from-green-50 to-green-100 border border-green-200 rounded-xl p-5">
                <div class="flex items-center gap-3 mb-3">
                    <div class="w-10 h-10 rounded-full bg-green-200 flex items-center justify-center">
                        <i class="fas fa-headset text-green-600"></i>
                    </div>
                    <h4 class="font-semibold text-gray-900">24/7 Support</h4>
                </div>
                <p class="text-sm text-gray-700">
                    Need help? Contact our support team anytime at 
                    <a href="mailto:support@clearq.in" class="text-green-700 hover:underline">support@clearq.in</a>
                </p>
            </div>
            
            <!-- Refund Info -->
            <div class="bg-gradient-to-br from-accent/10 to-accent/20 border border-accent/30 rounded-xl p-5">
                <div class="flex items-center gap-3 mb-3">
                    <div class="w-10 h-10 rounded-full bg-accent/20 flex items-center justify-center">
                        <i class="fas fa-undo text-accent"></i>
                    </div>
                    <h4 class="font-semibold text-gray-900">Easy Refunds</h4>
                </div>
                <p class="text-sm text-gray-700">
                    Cancel anytime up to 24 hours before the session for a full refund. Refunds processed within 5-7 business days.
                </p>
            </div>
        </div>

        <!-- Support Footer -->
        <div class="text-center py-6 border-t border-gray-200">
            <div class="flex flex-col sm:flex-row items-center justify-center gap-4">
                <div class="flex items-center gap-2 text-gray-600">
                    <i class="fas fa-question-circle"></i>
                    <span>Need assistance?</span>
                </div>
                <a href="mailto:support@clearq.in" class="px-4 py-2 bg-accent hover:bg-brand-red text-white rounded-lg font-medium transition-colors">
                    <i class="fas fa-envelope mr-2"></i>Contact Support
                </a>
                <a href="tel:+911234567890" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium transition-colors">
                    <i class="fas fa-phone mr-2"></i>+91 12345 67890
                </a>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-2xl p-8 max-w-md mx-4 text-center border border-gray-100 shadow-2xl transform transition-all duration-300 scale-95" id="successModalContent">
            <div class="success-check mb-6">
                <i class="fas fa-check-circle"></i>
            </div>
            <h3 class="text-2xl font-bold text-gray-900 mb-2">Payment Successful! ðŸŽ‰</h3>
            <p class="text-gray-600 mb-6" id="successMessage">Your payment has been verified. Redirecting...</p>
            <div class="flex justify-center mb-6">
                <div class="loader"></div>
            </div>
            <div class="progress-container">
                <div class="progress-bar" id="redirectProgress" style="width: 0%"></div>
            </div>
            <p class="text-sm text-gray-500 mt-4">Please wait while we confirm your booking...</p>
        </div>
    </div>

    <!-- Error Modal -->
    <div id="errorModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-2xl p-8 max-w-md mx-4 text-center border border-gray-100 shadow-2xl error-alert">
            <div class="w-20 h-20 rounded-full bg-red-50 flex items-center justify-center mx-auto mb-6">
                <i class="fas fa-exclamation-triangle text-red-500 text-3xl"></i>
            </div>
            <h3 class="text-2xl font-bold text-gray-900 mb-2">Payment Failed</h3>
            <p class="text-gray-600 mb-6" id="errorMessage">There was an issue processing your payment.</p>
            <div class="flex flex-col sm:flex-row gap-3 justify-center">
                <button id="retryButton" class="px-6 py-3 bg-accent hover:bg-brand-red text-white rounded-lg font-semibold transition-colors">
                    <i class="fas fa-redo mr-2"></i>Try Again
                </button>
                <button onclick="closeErrorModal()" class="px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-semibold transition-colors">
                    <i class="fas fa-times mr-2"></i>Cancel
                </button>
            </div>
            <p class="text-sm text-gray-500 mt-4">
                <i class="fas fa-info-circle mr-1"></i>
                If the issue persists, please contact support.
            </p>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notification-container" class="fixed top-6 right-6 z-50"></div>

    <!-- JavaScript -->
    <script>
        // Enhanced JavaScript with improved animations
        let selectedPaymentMethod = 'card';
        let currentRazorpayInstance = null;
        
        // Enhanced payment method selection with animation
        function selectPaymentMethod(method) {
            selectedPaymentMethod = method;
            
            // Remove active class from all
            document.querySelectorAll('.payment-option').forEach(option => {
                option.classList.remove('active', 'border-accent', 'border-green-500', 'border-blue-500');
                option.style.transform = '';
            });
            
            // Add active class to selected with animation
            const selectedOption = document.getElementById(method + 'Option');
            if (selectedOption) {
                selectedOption.classList.add('active');
                const colors = {
                    'card': 'accent',
                    'upi': 'green-500',
                    'netbanking': 'blue-500'
                };
                selectedOption.classList.add(`border-${colors[method] || 'accent'}`);
                
                // Bounce animation
                selectedOption.style.transform = 'scale(1.02)';
                setTimeout(() => {
                    selectedOption.style.transform = '';
                }, 300);
            }
            
            // Show selected method with fade in
            const methodNames = {
                'card': 'Credit/Debit Card',
                'upi': 'UPI (Google Pay, PhonePe, Paytm)',
                'netbanking': 'Net Banking'
            };
            
            const selectedMethod = document.getElementById('selectedMethod');
            const selectedMethodText = document.getElementById('selectedMethodText');
            
            selectedMethodText.textContent = methodNames[method] || method;
            
            // Animate in
            selectedMethod.classList.remove('hidden');
            selectedMethod.style.opacity = '0';
            selectedMethod.style.transform = 'translateY(-10px)';
            
            setTimeout(() => {
                selectedMethod.style.transition = 'all 0.3s ease';
                selectedMethod.style.opacity = '1';
                selectedMethod.style.transform = 'translateY(0)';
            }, 10);
        }
        
        // Enhanced copy UPI ID with toast
        function copyUPI() {
            const upiId = 'clearq@razorpay';
            navigator.clipboard.writeText(upiId)
                .then(() => {
                    showNotification('UPI ID copied to clipboard!', 'success');
                })
                .catch(err => {
                    showNotification('Failed to copy UPI ID', 'error');
                    console.error('Copy failed:', err);
                });
        }
        
        // Enhanced progress bar update
        function updateProgress(bar, percent) {
            if (bar) {
                bar.style.transition = 'width 0.5s cubic-bezier(0.4, 0, 0.2, 1)';
                bar.style.width = percent + '%';
            }
        }
        
        // Enhanced notification system
        function showNotification(message, type = 'info') {
            const container = document.getElementById('notification-container');
            
            // Remove existing notifications
            container.querySelectorAll('.notification-toast').forEach(toast => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            });
            
            // Create new notification
            const toast = document.createElement('div');
            toast.className = `notification-toast ${type}`;
            
            // Set colors based on type
            let bgColor = 'bg-gradient-to-r from-blue-500 to-blue-600 text-white';
            let icon = 'info-circle';
            
            if (type === 'success') {
                bgColor = 'bg-gradient-to-r from-green-500 to-green-600 text-white';
                icon = 'check-circle';
            } else if (type === 'error') {
                bgColor = 'bg-gradient-to-r from-red-500 to-red-600 text-white';
                icon = 'exclamation-circle';
            }
            
            toast.className += ' ' + bgColor;
            toast.innerHTML = `
                <i class="fas fa-${icon} text-lg"></i>
                <span class="font-medium">${message}</span>
                <button onclick="this.parentElement.classList.remove('show')" class="ml-auto">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            container.appendChild(toast);
            
            // Show with animation
            setTimeout(() => toast.classList.add('show'), 10);
            
            // Auto remove
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }
        
        // Enhanced success modal
        function showSuccessModal(message) {
            const successModal = document.getElementById('successModal');
            const successModalContent = document.getElementById('successModalContent');
            const successMessage = document.getElementById('successMessage');
            
            if (successMessage && message) {
                successMessage.textContent = message;
            }
            
            if (successModal) {
                successModal.classList.remove('hidden');
                setTimeout(() => {
                    successModalContent.style.transform = 'scale(1)';
                }, 10);
            }
            
            // Animate redirect progress
            const redirectProgress = document.getElementById('redirectProgress');
            let progress = 0;
            const interval = setInterval(() => {
                progress += 1;
                updateProgress(redirectProgress, progress);
                if (progress >= 100) {
                    clearInterval(interval);
                }
            }, 20);
        }
        
        // Enhanced error modal
        function showErrorModal(message) {
            const errorModal = document.getElementById('errorModal');
            const errorMessage = document.getElementById('errorMessage');
            
            if (errorMessage && message) {
                errorMessage.textContent = message;
            }
            
            if (errorModal) {
                errorModal.classList.remove('hidden');
            }
        }
        
        // Close error modal with animation
        function closeErrorModal() {
            const errorModal = document.getElementById('errorModal');
            if (errorModal) {
                errorModal.classList.add('hidden');
            }
        }
        
        // Enhanced payment button reset
        function resetPaymentButton() {
            const payButton = document.getElementById('payButton');
            if (payButton) {
                payButton.disabled = false;
                payButton.innerHTML = '<i class="fas fa-lock mr-3"></i>Pay â‚¹{{ payment_amount }} Now';
                payButton.classList.remove('opacity-50');
            }
        }
        
        // Initialize enhanced animations
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Enhanced payment page loaded');
            
            // Set default payment method with animation
            setTimeout(() => {
                selectPaymentMethod('card');
            }, 500);
            
            // Enhanced retry button
            const retryButton = document.getElementById('retryButton');
            if (retryButton) {
                retryButton.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    closeErrorModal();
                    resetPaymentButton();
                    const paymentProgress = document.getElementById('paymentProgress');
                    updateProgress(paymentProgress, 0);
                    
                    // Add slight delay for better UX
                    setTimeout(() => {
                        initializePayment();
                    }, 300);
                });
            }
            
            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                // Ctrl/Cmd + Enter to pay
                if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                    const payButton = document.getElementById('payButton');
                    if (payButton && !payButton.disabled) {
                        e.preventDefault();
                        payButton.click();
                    }
                }
                
                // Escape to close modals
                if (e.key === 'Escape') {
                    closeErrorModal();
                    const successModal = document.getElementById('successModal');
                    if (successModal) {
                        successModal.classList.add('hidden');
                    }
                    if (currentRazorpayInstance) {
                        currentRazorpayInstance.close();
                    }
                }
            });
            
            // Add hover effects to all interactive elements
            document.querySelectorAll('button, a').forEach(element => {
                if (element.classList.contains('no-hover')) return;
                
                element.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-2px)';
                });
                
                element.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                });
            });
            
            // Animate elements on scroll
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animate-fadeIn');
                    }
                });
            }, observerOptions);
            
            // Observe all cards
            document.querySelectorAll('.glass-card').forEach(card => {
                observer.observe(card);
            });
        });

        // Keep all existing payment functionality exactly as before
        // (initializePayment, verifyPaymentWithRetry functions remain unchanged)
    </script>
</body>
</html>
